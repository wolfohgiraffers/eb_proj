name: ela-prac-service

# cr.yml 이후 pr!!
permissions:
  contents: read
  pull-requests: write

on:
  push:
    branches:
      - "main"
      - "dev/feature/*"
#  pull_request:
#    types: [ opened, reopened, synchronize ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'corretto'

      - name: Grant execute permission for gradlew
        run: chmod +x ./gradlew
        shell: bash

      - name: Build with Gradle
        run: ./gradlew clean build -x test
        shell: bash

      - name: Get current time
        uses: 1466587594/get-current-time@v2
        id: current-time
        with:
          format: YYYY-MM-DDTHH-mm-ss
          utcOffset: "+09:00"

      - name: Show Current Time
        run: echo "CurrentTime=${{steps.current-time.outputs.formattedTime}}"
        shell: bash
  review:
    runs-on: ubuntu-latest
    steps:
      - name: ChatGPT 한국어 코드 리뷰어
        uses: anc95/ChatGPT-CodeReview@main
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          OPENAI_API_ENDPOINT: https://api.openai.com/v1
          MODEL: gpt-4
          PROMPT: |
            당신은 한국어로 코드 리뷰를 제공하는 전문가입니다. 다음 지침을 엄격히 따라주세요:
            1. 모든 응답은 반드시 한국어로만 작성하세요.
            2. 기존 코드와 새 코드의 차이점을 자세히 분석하세요.
            3. 코드의 개선점, 잠재적인 문제점, 그리고 좋은 점들을 구체적으로 설명하세요.
            4. 가능한 개선 사항에 대해 실제 코드 예시를 한국어 설명과 함께 제공하세요.
            5. 코드 품질, 성능, 보안 측면에서의 의견을 제시하세요.
            6. 리뷰는 건설적이고 교육적인 톤으로 작성하세요.
            7. 리뷰 끝에는 전체적인 요약과 주요 개선 포인트를 한국어로 정리해주세요.
          TOP_P: 1
          TEMPERATURE: 1
          MAX_TOKENS: 10000
          MAX_PATCH_LENGTH: 10000
